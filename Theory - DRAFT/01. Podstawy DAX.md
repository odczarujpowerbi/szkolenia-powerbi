# Podstawy DAX

## Podstawowa skÅ‚adnia miary

Miara w DAX to formuÅ‚a, ktÃ³ra oblicza wartoÅ›Ä‡ na podstawie kontekstu filtrÃ³w w raporcie. KaÅ¼da miara ma swojÄ… nazwÄ™ i wyraÅ¼enie, ktÃ³re definiuje sposÃ³b obliczenia.

### Struktura miary

```dax
Nazwa_miary = wyraÅ¼enie
```

**PrzykÅ‚ad:**
```dax
Total Revenue = SUMX(fDemo, fDemo[Price] * fDemo[Quantity])
```

W powyÅ¼szym przykÅ‚adzie:
- `Total Revenue` to nazwa miary
- `SUMX(fDemo, fDemo[Price] * fDemo[Quantity])` to wyraÅ¼enie obliczajÄ…ce przychÃ³d

### Zasady nazewnictwa miar

- Nazwa miary powinna byÄ‡ opisowa i zrozumiaÅ‚a
- Unikaj polskich znakÃ³w w nazwach (Ä…, Ä™, Å‚, itd.) - mogÄ… powodowaÄ‡ problemy
- Stosuj konwencjÄ™ nazewnictwa, np.:
  - `Total Sales` zamiast `suma_sprzedaÅ¼y`
  - `Average Price` zamiast `Å›rednia cena`

---

## WartoÅ›Ä‡ skalarna - czym jest i dlaczego jest waÅ¼na

**WartoÅ›Ä‡ skalarna** to pojedyncza wartoÅ›Ä‡ - jedna liczba, jeden tekst, jedna data. Miara w Power BI **zawsze musi zwracaÄ‡ wartoÅ›Ä‡ skalarnÄ…**.

### PrzykÅ‚ad wartoÅ›ci skalarnej

```dax
Simple Measure = 1 + 1
```

Ta miara zwrÃ³ci wartoÅ›Ä‡ `2` - to jest wartoÅ›Ä‡ skalarna.

### PorÃ³wnanie: wartoÅ›Ä‡ skalarna vs tabela wartoÅ›ci

| WartoÅ›Ä‡ skalarna | Tabela wartoÅ›ci |
|------------------|-----------------|
| `2` | `{2, 5, 10}` |
| `"Electronics"` | `{"Electronics", "Home", "Garden"}` |
| Jedna wartoÅ›Ä‡ | Wiele wartoÅ›ci |
| âœ“ MoÅ¼na uÅ¼yÄ‡ w miarze | âœ— Nie moÅ¼na bezpoÅ›rednio uÅ¼yÄ‡ w miarze |

### Miara musi zwracaÄ‡ wartoÅ›Ä‡ skalarnÄ…

```dax
// âœ“ Poprawnie - zwraca jednÄ… liczbÄ™
Total Quantity = SUM(fDemo[Quantity])

// âœ— BÅ‚Ä…d - prÃ³ba zwrÃ³cenia wielu wartoÅ›ci
Invalid Measure = fDemo[Quantity]  // To jest caÅ‚a kolumna, nie jedna wartoÅ›Ä‡!
```

JeÅ›li chcesz pracowaÄ‡ na wielu wartoÅ›ciach (np. na caÅ‚ej kolumnie), musisz uÅ¼yÄ‡ funkcji agregujÄ…cej, takiej jak:
- `SUM()` - suma
- `AVERAGE()` - Å›rednia
- `MAX()` - maksimum
- `MIN()` - minimum
- `COUNT()` - liczba elementÃ³w

**PrzykÅ‚ad:**
```dax
Max Price = MAX(fDemo[Price])
```

Ta miara przeglÄ…da wszystkie wartoÅ›ci w kolumnie `fDemo[Price]` i zwraca jednÄ… wartoÅ›Ä‡ - najwyÅ¼szÄ… cenÄ™.

---

## Jak Power BI oblicza miary

Power BI oblicza miary **dynamicznie**, w momencie gdy uÅ¼ytkownik wchodzi w interakcjÄ™ z raportem. WartoÅ›Ä‡ miary zaleÅ¼y od **kontekstu filtrÃ³w**.

### Kontekst filtru

Kontekst filtru to zestaw filtrÃ³w aktywnych w danym momencie. Wynika on z:
- FiltrÃ³w zastosowanych na wizualizacji
- FiltrÃ³w na poziomie strony
- FiltrÃ³w na poziomie raportu
- SlicerÃ³w (wyborÃ³w uÅ¼ytkownika)
- Wyboru elementu w jednej wizualizacji (cross-filtering)

### PrzykÅ‚ad obliczania miary

ZaÅ‚Ã³Å¼my, Å¼e stworzyliÅ›my miarÄ™:

```dax
Total Sales = SUMX(fDemo, fDemo[Price] * fDemo[Quantity])
```

**Scenariusz 1: Brak filtrÃ³w**
- Power BI oblicza sprzedaÅ¼ dla wszystkich 25 wierszy z tabeli fDemo
- Wynik: suma sprzedaÅ¼y ze wszystkich produktÃ³w

**Scenariusz 2: Filtr na kategoriÄ™ "Electronics"**
- Power BI oblicza sprzedaÅ¼ tylko dla wierszy, gdzie `Category = "Electronics"`
- Wynik: suma sprzedaÅ¼y tylko z kategorii Electronics (wiersze 1-4)

**Scenariusz 3: Filtr na kategoriÄ™ "Home" i segment "Retail"**
- Power BI oblicza sprzedaÅ¼ dla wierszy, gdzie `Category = "Home"` AND `Segment = "Retail"`
- Wynik: suma sprzedaÅ¼y tylko z kategorii Home w segmencie Retail (wiersze 5, 7)

### Wizualizacja procesu

```
Tabela wizualizacji:
+-------------+-------------+
| Category    | Total Sales |
+-------------+-------------+
| Electronics | ???         | <- Power BI filtruje fDemo do Category = "Electronics" i oblicza
| Home        | ???         | <- Power BI filtruje fDemo do Category = "Home" i oblicza
| Garden      | ???         | <- Power BI filtruje fDemo do Category = "Garden" i oblicza
+-------------+-------------+
```

KaÅ¼dy wiersz w tej tabeli ma inny kontekst filtru, wiÄ™c Power BI oblicza miarÄ™ osobno dla kaÅ¼dego wiersza.

---

## Gdzie zapisujÄ… siÄ™ miary w modelu

Miary w Power BI sÄ… obiektami **niezaleÅ¼nymi od tabel**. Mimo Å¼e technicznie sÄ… "przypisane" do jakiejÅ› tabeli w widoku danych, **nie ma znaczenia, w ktÃ³rej tabeli znajduje siÄ™ miara**.

### Dlaczego lokalizacja miary nie ma znaczenia?

Miara to formuÅ‚a, ktÃ³ra moÅ¼e odwoÅ‚ywaÄ‡ siÄ™ do dowolnych tabel w modelu:

```dax
Total Sales = SUMX(fDemo, fDemo[Price] * fDemo[Quantity])
```

Ta miara moÅ¼e byÄ‡ zapisana w tabeli `fDemo`, w tabeli `Measures`, albo w dowolnej innej tabeli - **wynik bÄ™dzie identyczny**.

### Najlepsze praktyki

Mimo Å¼e technicznie lokalizacja miary nie ma znaczenia, warto stosowaÄ‡ organizacjÄ™:

#### Wariant 1: Dedykowana tabela na miary

UtwÃ³rz pustÄ… tabelÄ™ tylko na miary:

```dax
Measures = BLANK()
```

Wszystkie miary przechowuj w tej tabeli - dziÄ™ki temu Å‚atwo je znajdziesz.

#### Wariant 2: Grupowanie miar wedÅ‚ug tematÃ³w

Miary zwiÄ…zane ze sprzedaÅ¼Ä… â†’ tabela `fDemo` lub `Sales_Measures`
Miary zwiÄ…zane z czasem â†’ tabela `Calendar_Measures`

### Uwaga techniczna

ChoÄ‡ miara moÅ¼e znajdowaÄ‡ siÄ™ w dowolnej tabeli, **dobra organizacja** znaczÄ…co uÅ‚atwia pracÄ™ z modelem, zwÅ‚aszcza gdy liczba miar roÅ›nie.

---

## Miara vs Kolumna kalkulowana - kluczowe rÃ³Å¼nice

W Power BI istniejÄ… dwa gÅ‚Ã³wne typy obliczeÅ„: **miary** i **kolumny kalkulowane**. ChoÄ‡ obie pozwalajÄ… na przeprowadzanie obliczeÅ„, rÃ³Å¼niÄ… siÄ™ fundamentalnie.

### Podstawowe rÃ³Å¼nice

| Cecha | Miara | Kolumna kalkulowana |
|-------|-------|---------------------|
| **Moment obliczania** | Dynamicznie, podczas interakcji z raportem | Podczas odÅ›wieÅ¼ania danych |
| **Przechowywanie** | Nie zajmuje miejsca w modelu | Zajmuje miejsce w modelu (kaÅ¼dy wiersz) |
| **Kontekst** | Kontekst filtru | Kontekst wiersza |
| **UÅ¼ycie w wizualizacjach** | W polach wartoÅ›ci (Values) | W osiach, legendach, slicerach, wartoÅ›ciach |
| **WydajnoÅ›Ä‡** | Szybka, obliczana na Å¼Ä…danie | MoÅ¼e spowalniaÄ‡ odÅ›wieÅ¼anie |

### Kiedy uÅ¼ywaÄ‡ miary?

UÅ¼ywaj miary, gdy chcesz obliczyÄ‡:
- **Agregacje**: sumy, Å›rednie, liczby
- **WartoÅ›ci zmieniajÄ…ce siÄ™ w zaleÅ¼noÅ›ci od kontekstu**
- **KPI i metryki biznesowe**

**PrzykÅ‚ad:**
```dax
Total Revenue = SUMX(fDemo, fDemo[Price] * fDemo[Quantity])
```

Ta miara obliczy przychÃ³d dynamicznie - w zaleÅ¼noÅ›ci od tego, jakie filtry sÄ… aktywne.

### Kiedy uÅ¼ywaÄ‡ kolumny kalkulowanej?

UÅ¼ywaj kolumny kalkulowanej, gdy chcesz:
- **FiltrowaÄ‡ lub grupowaÄ‡** po obliczonej wartoÅ›ci
- **SortowaÄ‡** niestandardowo
- **ObliczyÄ‡ wartoÅ›Ä‡ dla kaÅ¼dego wiersza**, ktÃ³ra nie zmienia siÄ™ w zaleÅ¼noÅ›ci od kontekstu

**PrzykÅ‚ad:**
```dax
Revenue per Row = fDemo[Price] * fDemo[Quantity]
```

Ta kolumna obliczy przychÃ³d osobno dla kaÅ¼dego wiersza i zachowa go w modelu.

### SzczegÃ³Å‚owe porÃ³wnanie: moment obliczania

#### Miara - obliczana podczas interakcji

```dax
Total Discount = SUM(fDemo[Discount])
```

- Gdy uÅ¼ytkownik wybierze kategoriÄ™ "Electronics", miara obliczy sumÄ™ rabatÃ³w tylko dla tej kategorii
- Gdy uÅ¼ytkownik usunie filtr, miara przeliczy siÄ™ automatycznie dla wszystkich danych
- **Obliczenie nastÄ™puje na Å¼Ä…danie**

#### Kolumna kalkulowana - obliczana podczas odÅ›wieÅ¼ania

```dax
Discount Category =
IF(fDemo[Discount] > 10, "High", "Low")
```

- Ta kolumna zostanie obliczona raz - podczas odÅ›wieÅ¼ania danych
- KaÅ¼dy wiersz otrzyma wartoÅ›Ä‡ "High" lub "Low"
- WartoÅ›Ä‡ jest **zapisana w modelu** i nie zmienia siÄ™ dynamicznie

### WydajnoÅ›Ä‡ - kluczowe rÃ³Å¼nice

#### Miary - wydajne w uÅ¼yciu

- Nie zajmujÄ… miejsca w pamiÄ™ci
- Obliczane sÄ… tylko wtedy, gdy sÄ… potrzebne
- **Zalecane** dla wiÄ™kszoÅ›ci obliczeÅ„

#### Kolumny kalkulowane - mogÄ… spowalniaÄ‡

- KaÅ¼dy wiersz tabeli przechowuje wartoÅ›Ä‡ kolumny
- Im wiÄ™cej wierszy, tym wiÄ™cej pamiÄ™ci zajmujÄ…
- SpowalniajÄ… odÅ›wieÅ¼anie danych
- **UÅ¼ywaj oszczÄ™dnie**, tylko gdy rzeczywiÅ›cie potrzebne

### Zastosowanie w wizualizacjach

#### Kolumny - gdy musisz filtrowaÄ‡ lub grupowaÄ‡

JeÅ›li chcesz:
- FiltrowaÄ‡ dane po obliczonej wartoÅ›ci (slicer)
- GrupowaÄ‡ wyniki (oÅ› wykresu)
- SortowaÄ‡ niestandardowo

**PrzykÅ‚ad:**
```dax
Price Range =
SWITCH(
    TRUE(),
    fDemo[Price] <= 30, "Low",
    fDemo[Price] <= 70, "Medium",
    "High"
)
```

MoÅ¼esz uÅ¼yÄ‡ tej kolumny jako slicer lub oÅ› wykresu, aby zobaczyÄ‡ sprzedaÅ¼ wedÅ‚ug przedziaÅ‚Ã³w cenowych.

#### Miary - do obliczeÅ„ agregatÃ³w

JeÅ›li chcesz:
- PokazaÄ‡ sumÄ™, Å›redniÄ…, liczbÄ™
- ObliczyÄ‡ wartoÅ›Ä‡ dynamicznie reagujÄ…cÄ… na filtry

**PrzykÅ‚ad:**
```dax
Average Quantity = AVERAGE(fDemo[Quantity])
```

Ta miara zawsze obliczy Å›redniÄ… iloÅ›Ä‡ w kontekÅ›cie aktywnych filtrÃ³w.

---

## PrzykÅ‚ady: ta sama logika jako kolumna i jako miara

### PrzykÅ‚ad 1: Obliczenie przychodu (Revenue)

#### Jako kolumna kalkulowana

```dax
Revenue (Column) = fDemo[Price] * fDemo[Quantity]
```

**Wynik:**
- Kolumna `Revenue (Column)` zostanie dodana do tabeli fDemo
- KaÅ¼dy wiersz bÄ™dzie miaÅ‚ obliczony przychÃ³d
- Zajmie miejsce w pamiÄ™ci: 25 wartoÅ›ci (po jednej dla kaÅ¼dego wiersza)

**UÅ¼ycie:**
MoÅ¼esz uÅ¼yÄ‡ tej kolumny do filtrowania (np. pokaÅ¼ tylko wiersze z przychodem > 200) lub jako oÅ› wykresu.

#### Jako miara

```dax
Total Revenue = SUMX(fDemo, fDemo[Price] * fDemo[Quantity])
```

**Wynik:**
- Miara oblicza sumÄ™ przychodÃ³w dynamicznie
- Nie zajmuje miejsca w pamiÄ™ci
- Reaguje na filtry w raporcie

**UÅ¼ycie:**
MoÅ¼esz uÅ¼yÄ‡ tej miary w polu wartoÅ›ci (Values) na wykresie lub karcie.

### PrzykÅ‚ad 2: Kategoryzacja rabatu

#### Jako kolumna kalkulowana

```dax
Discount Level =
IF(fDemo[Discount] >= 10, "High Discount", "Low Discount")
```

**Wynik:**
- KaÅ¼dy wiersz otrzyma etykietÄ™ "High Discount" lub "Low Discount"
- MoÅ¼na uÅ¼yÄ‡ jako slicer lub filtr

**UÅ¼ycie:**
StwÃ³rz wykres pokazujÄ…cy sprzedaÅ¼ wedÅ‚ug poziomu rabatu (High vs Low).

#### Jako miara (bardziej zaawansowane)

```dax
Discount Category Text =
IF(
    SELECTEDVALUE(fDemo[Discount]) >= 10,
    "High Discount",
    "Low Discount"
)
```

**Wynik:**
- Miara zwrÃ³ci tekst w zaleÅ¼noÅ›ci od kontekstu
- DziaÅ‚a tylko gdy w kontekÅ›cie jest jedna wartoÅ›Ä‡ rabatu

**Uwaga:** W tym przypadku **kolumna jest lepszym wyborem**, bo chcemy kategoryzowaÄ‡ dane do filtrowania.

### Kiedy uÅ¼yÄ‡ ktÃ³rej opcji?

| Cel | UÅ¼yj |
|-----|------|
| Obliczenie wartoÅ›ci dla kaÅ¼dego wiersza do filtrowania | Kolumna kalkulowana |
| Agregacja (suma, Å›rednia) reagujÄ…ca na filtry | Miara |
| Grupowanie lub sortowanie | Kolumna kalkulowana |
| KPI i metryki biznesowe | Miara |
| Kategorie do slicerÃ³w | Kolumna kalkulowana |

---

## Organizacja modelu - foldery na miary

Gdy liczba miar roÅ›nie, Å‚atwo straciÄ‡ orientacjÄ™ w modelu. **Foldery na miary** (Display Folders) pomagajÄ… utrzymaÄ‡ porzÄ…dek.

### Po co stosowaÄ‡ foldery na miary?

- **Organizacja**: Grupowanie powiÄ…zanych miar tematycznie
- **CzytelnoÅ›Ä‡**: Åatwiejsze znajdowanie miar w duÅ¼ych modelach
- **Profesjonalizm**: UporzÄ…dkowany model jest Å‚atwiejszy do utrzymania i przekazania innym

### Tworzenie folderÃ³w - krok po kroku

#### Krok 1: Wybierz miarÄ™

W widoku **Raport** lub **Dane**:
1. Kliknij na miarÄ™, ktÃ³rÄ… chcesz umieÅ›ciÄ‡ w folderze

#### Krok 2: Ustaw Display Folder

W panelu **WÅ‚aÅ›ciwoÅ›ci** (po prawej stronie):
1. ZnajdÅº pole **Display Folder**
2. Wpisz nazwÄ™ folderu, np. `Sales`
3. NaciÅ›nij Enter

Miara zostanie przeniesiona do folderu `Sales`.

#### Krok 3: Tworzenie zagnieÅ¼dÅ¼onych folderÃ³w

MoÅ¼esz tworzyÄ‡ hierarchiÄ™ folderÃ³w, uÅ¼ywajÄ…c znaku `\`:

```
Sales\Revenue
Sales\Costs
Time Intelligence\YTD
Time Intelligence\MoM
```

**PrzykÅ‚ad:**
- Display Folder: `Sales\Revenue`
- Miara `Total Revenue` pojawi siÄ™ w folderze `Sales` â†’ `Revenue`

### PrzykÅ‚adowa struktura folderÃ³w

Dla projektu bazujÄ…cego na tabeli `fDemo` moÅ¼esz zastosowaÄ‡:

```
ğŸ“ Sales
   ğŸ“Š Total Revenue
   ğŸ“Š Total Quantity
   ğŸ“Š Average Price

ğŸ“ Discounts
   ğŸ“Š Total Discount
   ğŸ“Š Average Discount %

ğŸ“ Segmentation
   ğŸ“Š Revenue by Segment
   ğŸ“Š Count by Category

ğŸ“ Calculations
   ğŸ“Š Net Revenue (after discount)
   ğŸ“Š Profit Margin
```

### KorzyÅ›ci z uÅ¼ywania folderÃ³w

âœ“ **Szybkie znajdowanie miar** - szczegÃ³lnie w modelach z dziesiÄ…tkami miar
âœ“ **Logiczne grupowanie** - powiÄ…zane miary razem
âœ“ **Åatwiejsza wspÃ³Å‚praca** - inne osoby Å‚atwiej zrozumiejÄ… strukturÄ™
âœ“ **SkalowalnoÅ›Ä‡** - Å‚atwo dodawaÄ‡ nowe miary do odpowiednich kategorii

### PrzykÅ‚adowe grupowania tematyczne

| Folder | PrzykÅ‚adowe miary |
|--------|-------------------|
| **Sales** | Total Sales, Total Revenue, Units Sold |
| **Margin** | Gross Margin, Net Margin, Margin % |
| **Time Intelligence** | YTD Sales, MoM Growth, QoQ Change |
| **KPI** | Sales Target, Target Achievement %, Variance |
| **Customer** | Customer Count, Avg Purchase Value, Retention Rate |

---

## Podsumowanie

### Kluczowe zasady pracy z miarami

âœ“ **Miara zawsze zwraca wartoÅ›Ä‡ skalarnÄ…** - jednÄ… liczbÄ™, tekst lub datÄ™
âœ“ **Miary obliczajÄ… siÄ™ dynamicznie** - reagujÄ… na kontekst filtrÃ³w
âœ“ **Lokalizacja miary nie ma znaczenia** - ale organizacja ma!
âœ“ **UÅ¼ywaj miar do agregacji** - sumy, Å›rednie, liczby
âœ“ **UÅ¼ywaj kolumn do filtrowania** - gdy potrzebujesz grupowaÄ‡ lub sortowaÄ‡

### Miara vs Kolumna - szybkie przypomnienie

| UÅ¼yj miary gdy... | UÅ¼yj kolumny gdy... |
|-------------------|---------------------|
| Liczysz sumÄ™, Å›redniÄ…, maksimum | Chcesz filtrowaÄ‡ po obliczonej wartoÅ›ci |
| Wynik ma siÄ™ zmieniaÄ‡ z filtrami | WartoÅ›Ä‡ ma byÄ‡ staÅ‚a dla wiersza |
| Chcesz zaoszczÄ™dziÄ‡ pamiÄ™Ä‡ | Musisz sortowaÄ‡ niestandardowo |
| Obliczasz KPI | Tworzysz kategorie do slicerÃ³w |

### Kolejne kroki

Teraz, gdy znasz podstawy DAX, moÅ¼esz przejÅ›Ä‡ do bardziej zaawansowanych tematÃ³w:
- Funkcja `CALCULATE` - najpotÄ™Å¼niejsze narzÄ™dzie w DAX
- Manipulacja kontekstem filtrÃ³w
- Time Intelligence - analiza danych w czasie
- Funkcje iteracyjne (SUMX, AVERAGEX, itd.)

PamiÄ™taj: **Dobra organizacja modelu od poczÄ…tku** zaoszczÄ™dzi Ci wiele czasu w przyszÅ‚oÅ›ci!
