# Miary vs Kolumny kalkulowane

Jedną z najważniejszych rzeczy do zrozumienia w DAX jest różnica między **miarami** a **kolumnami kalkulowanymi**. Choć obie używają formuł DAX, działają zupełnie inaczej.

## Kolumny kalkulowane (Calculated Columns)

**Kolumna kalkulowana** to nowa kolumna dodana do tabeli, której wartość jest obliczana **wiersz po wierszu** w momencie odświeżania danych.

### Charakterystyka kolumn kalkulowanych:

- Obliczane **podczas ładowania/odświeżania danych**
- Wartość obliczana **dla każdego wiersza** w tabeli
- Wynik jest **przechowywany** w modelu (zajmuje miejsce w pamięci)
- Można ich używać do **filtrowania**, **grupowania** lub **sortowania**
- Używają **kontekstu wiersza** (row context)

### Przykład kolumny kalkulowanej:

```dax
Cena Jednostkowa =
Sprzedaż[Wartość netto] / Sprzedaż[Ilość]
```

**Co się dzieje:**
- Formuła jest obliczana **dla każdego wiersza** w tabeli Sprzedaż
- Jeśli masz 1000 wierszy, otrzymasz 1000 wartości
- Wartości są zapisane w modelu i widoczne w widoku danych
- Możesz użyć tej kolumny w slicerach, filtrach lub do sortowania

**Kiedy używać kolumn kalkulowanych:**
- Potrzebujesz wartości do **filtrowania** lub **grupowania**
- Chcesz **posortować** dane według obliczonej wartości
- Wartość zależy **tylko od danych w bieżącym wierszu**
- Przykład: kategoria cenowa produktu, wiek klienta, dzień tygodnia

---

## Miary (Measures)

**Miara** to formuła, która oblicza się **dynamicznie** w zależności od kontekstu filtrów w raporcie.

### Charakterystyka miar:

- Obliczane **w momencie wyświetlania** w wizualizacji
- Nie są przechowywane w modelu (nie zajmują miejsca)
- Wynik zależy od **kontekstu filtrów** na wizualizacji
- **Nie można** ich użyć do filtrowania wierszy
- Używają **kontekstu filtrów** (filter context)

### Przykład miary:

```dax
Sprzedaż Netto = SUM(Sprzedaż[Wartość netto])
```

**Co się dzieje:**
- Formuła oblicza sumę **w zależności od kontekstu**
- Na wykresie według kategorii: pokaże sumę dla każdej kategorii
- Na wykresie według regionu: pokaże sumę dla każdego regionu
- Bez filtrów: pokaże sumę całkowitą
- Wartość **nie jest przechowywana**, tylko obliczana na żądanie

**Kiedy używać miar:**
- Potrzebujesz **agregacji** (suma, średnia, liczba)
- Wynik ma zależeć od **filtrów w raporcie**
- Chcesz **dynamicznych obliczeń** (procent udziału, porównania okresów)
- Przykład: suma sprzedaży, średnia wartość, liczba transakcji

---

## Porównanie: Kolumna kalkulowana vs Miara

| Aspekt | Kolumna kalkulowana | Miara |
|--------|-------------------|-------|
| **Kiedy obliczana** | Podczas odświeżania danych | Podczas wyświetlania wizualizacji |
| **Kontekst** | Kontekst wiersza (row context) | Kontekst filtrów (filter context) |
| **Przechowywanie** | Tak - zajmuje miejsce w pamięci | Nie - obliczana na żądanie |
| **Użycie w slicerach** | Tak | Nie |
| **Użycie w wizualizacjach** | Jako pole do grupowania | Jako wartość do agregacji |
| **Ikona w Power BI** | Ikona tabeli (⚏) | Ikona kalkulatora (fx) |

---

## Praktyczny przykład

Mamy tabelę Sprzedaż z danymi o transakcjach. Zobaczmy różnicę:

### Kolumna kalkulowana - Wartość za sztukę

```dax
Wartość za Sztukę =
DIVIDE(Sprzedaż[Wartość netto], Sprzedaż[Ilość], 0)
```

**Wynik:**
- Obliczona dla każdego wiersza
- W tabeli dane będziesz mieć kolumnę z wartością dla każdej transakcji
- Możesz użyć do filtrowania: "pokaż tylko transakcje gdzie Wartość za Sztukę > 50"

### Miara - Średnia Wartość Transakcji

```dax
Średnia Wartość Transakcji =
AVERAGE(Sprzedaż[Wartość netto])
```

**Wynik:**
- Obliczana dynamicznie według kontekstu
- Według kategorii: średnia dla każdej kategorii
- Według regionu: średnia dla każdego regionu
- W karcie: średnia dla wszystkich danych (lub wybranych w slicerze)

---

## Najczęstszy błąd początkujących

**Błąd:** Tworzenie kolumny kalkulowanej zamiast miary dla agregacji.

```dax
// ❌ ZŁE - kolumna kalkulowana (niepotrzebnie zajmuje pamięć)
Suma Wartości Kolumna = SUM(Sprzedaż[Wartość netto])

// ✅ DOBRE - miara (dynamiczna, nie zajmuje pamięci)
Suma Wartości Miara = SUM(Sprzedaż[Wartość netto])
```

**Zasada:** Jeśli używasz funkcji agregującej (SUM, AVERAGE, COUNT, itp.), prawie zawsze powinieneś tworzyć **miarę**, nie kolumnę.

---

## Kiedy używać czego? - Decyzja

**Użyj kolumny kalkulowanej gdy:**
- ✓ Potrzebujesz wartości do **filtrowania** (slicer, filtr)
- ✓ Chcesz **grupować** według obliczonej wartości
- ✓ Wartość zależy tylko od **bieżącego wiersza**
- ✓ Przykład: "Kategoria wiekowa klienta", "Dzień tygodnia sprzedaży"

**Użyj miary gdy:**
- ✓ Potrzebujesz **agregacji** (suma, średnia, liczba)
- ✓ Wynik ma być **dynamiczny** (zależny od filtrów)
- ✓ Chcesz **oszczędzić pamięć** w modelu
- ✓ Przykład: "Suma sprzedaży", "Liczba transakcji", "Średnia wartość"

---
