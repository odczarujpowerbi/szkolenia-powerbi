---
type: teoria
---

# SAMEPERIODLASTYEAR

## Definicja

```dax
SAMEPERIODLASTYEAR(<dates>)
```

Zwraca ten sam okres, ale przesunięty dokładnie o **1 rok wstecz**. Działa dla dni, tygodni, miesięcy, kwartałów i lat.

## Zastosowanie

**Tabela źródłowa:**

|Data|Wartość|
|:--|--:|
|2024-01-15|3000|
|2024-02-10|2400|
|2023-01-15|2800|
|2023-02-10|2200|

---
### Przykład 1: Sprzedaż rok do roku (YoY)

```dax
Sprzedaż RR = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    SAMEPERIODLASTYEAR(Kalendarz[Data])
)
```


**Jak działa iteracja:**

| Bieżący okres | Przesunięcie → | Wartość RR |
| :------------ | :------------- | ---------: |
| 2024-01-15    | → 2023-01-15   |       2800 |
| 2024-02-10    | → 2023-02-10   |       2200 |
| Styczeń 2024  | → Styczeń 2023 |       2800 |
| Q1 2024       | → Q1 2023      |       5000 |

---
### Przykład 2: Dynamika YoY w procentach

```dax
Wzrost YoY % = 
DIVIDE(
    SUM(fSprzedaz[Wartość]) - [Sprzedaż RR],
    [Sprzedaż RR]
)
```

**Wyniki:**

|Miesiąc|Wartość 2024|Wartość 2023|Wzrost YoY %|
|:--|--:|--:|--:|
|Styczeń|3000|2800|+7,1%|
|Luty|2400|2200|+9,1%|


---
### Przykład 3: Porównanie YTD rok do roku

```dax
Sprzedaż YTD RR = 
CALCULATE(
    [Sprzedaż YTD],
    SAMEPERIODLASTYEAR(Kalendarz[Data])
)
```

**Porównanie kumulacji:**

|Okres|YTD 2024|YTD 2023|Różnica|
|:--|--:|--:|--:|
|Do 31.01|3000|2800|+200|
|Do 28.02|5400|5000|+400|

---

# DATESYTD

## Definicja

```dax
DATESYTD(<dates>, [<year_end_date>])
```

Zwraca wszystkie daty od **początku roku** do ostatniej daty w bieżącym kontekście filtra. Służy do tworzenia kumulacji rocznej (YTD - Year to Date).

---
## Zastosowanie

**Tabela źródłowa:**

| Data       | Wartość |
| :--------- | ------: |
| 2023-12-30 |    3000 |
| 2024-01-02 |     500 |
| 2024-01-03 |    2400 |
| 2024-01-04 |     750 |
| 2024-02-05 |     100 |


### Przykład 1: Sprzedaż YTD


```dax
Sprzedaż YTD = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    DATESYTD(Kalendarz[Data])
)
```

**Proces kumulacji**

| Data       | Wartość | W zakresie YTD? | Kumulacja YTD |
| :--------- | ------: | :-------------- | ------------: |
| 2023-12-30 |    3000 | ❌ Przeszłość    |             0 |
| 2024-01-02 |     500 | ✅               |           500 |
| 2024-01-03 |    2400 | ✅               |          2900 |
| 2024-01-04 |     750 | ✅               |          3650 |
| 2024-01-05 |     100 | ✅ **← Dziś**    |      **3750** |



---
### Przykład 2: Porównanie bieżący vs poprzedni YTD

```dax
Różnica YTD vs RR = 
[Sprzedaż YTD] - [Sprzedaż YTD RR]
```

**Wyniki:**

|Data analizy|YTD bieżący|YTD rok temu|Różnica|
|:--|--:|--:|--:|
|31.01.2024|3500|2800|+700|
|29.02.2024|6650|5000|+1650|

---

# DATEADD

## Definicja

```dax
DATEADD(<dates>, <number_of_intervals>, <interval>)
```

Przesuwa daty o określoną liczbę **interwałów** (dni, miesięcy, kwartałów, lat). Może przesuwać **wstecz** (wartość ujemna) lub **wprzód** (wartość dodatnia).

**Interwały:** DAY, MONTH, QUARTER, YEAR

---

## Zastosowanie

**Tabela źródłowa:**

| Data          | Wartość |
| :------------ | ------: |
| Grudzien 2023 |    1000 |
| Styczeń 2024  |    3000 |
| Luty 2024     |    2400 |
| Marzec 2024   |    1800 |

### Przykład 1: Miesiąc do miesiąca (MoM)

```dax
Sprzedaż Poprzedni Miesiąc = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    DATEADD(Kalendarz[Data], -1, MONTH)
)
```


**Mapowanie okresów:**

| Data          | Wartość dla DATEADD(-1, MONTH) |
| :------------ | -----------------------------: |
| Styczeń 2024  |                           1000 |
| Luty 2024     |                           3000 |
| Marzec 2024   |                           2400 |
| Kwiecień 2024 |                           1800 |

**Zmiana MoM:**

```dax
Zmiana MoM % = 
DIVIDE(
    SUM(fSprzedaz[Wartość]) - [Sprzedaż Poprzedni Miesiąc],
    [Sprzedaż Poprzedni Miesiąc]
)
```

|Miesiąc|Wartość|Poprzedni|Zmiana %|
|:--|--:|--:|--:|
|Luty|2400|3000|-20%|
|Marzec|1800|2400|-25%|


---
### Przykład 2: Dokładnie rok temu

```dax
Sprzedaż Dokładnie Rok Temu = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    DATEADD(Kalendarz[Data], -1, YEAR)
)
```

**Mapowanie roczne:**

|Bieżąca data|DATEADD(-1, YEAR) →|Wartość rok temu|
|:--|:--|--:|
|2024-01-15|2023-01-15|2800|
|2024-02-10|2023-02-10|2200|
|2024-02-29|2023-02-28|1900|

# DATESINPERIOD

## Definicja

```dax
DATESINPERIOD(<dates>, <start_date>, <number_of_intervals>, <interval>)
```

Zwraca **okno przewijane** dat rozpoczynające się od określonej daty i rozciągające się o zadaną liczbę interwałów wstecz lub wprzód.

**Interwały:** DAY, MONTH, QUARTER, YEAR


---
## Zastosowanie

**Tabela źródłowa:**

|Data|Wartość|
|:--|--:|
|2024-02-08|600|
|2024-02-09|800|
|2024-02-10|2400|
|2024-02-14|1100|
|2024-02-15|900|

### Przykład 1: Ostatnie 7 dni (Rolling 7 days)

```dax
Sprzedaż Ostatnie 7 Dni = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    DATESINPERIOD(
        Kalendarz[Data],
        MAX(Kalendarz[Data]),
        -7,
        DAY
    )
)
```


**Okno przewijane (stan na 2024-02-15):**

|Data|Wartość|W oknie 7 dni?|Kumulacja|
|:--|--:|:--|--:|
|2024-02-07|500|❌ >7 dni temu|-|
|2024-02-08|600|❌ >7 dni temu|-|
|2024-02-09|800|✅ Tak|800|
|2024-02-10|2400|✅ Tak|3200|
|2024-02-14|1100|✅ Tak|4300|
|2024-02-15|900|✅ Tak **← Dziś**|**5200**|


---
### Przykład 2: Ostatnie 3 miesiące

```dax
Sprzedaż Ostatnie 3M = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    DATESINPERIOD(
        Kalendarz[Data],
        MAX(Kalendarz[Data]),
        -3,
        MONTH
    )
)
```

**Okno 3 miesięcy (na 15.02.2024):**

|Miesiąc|Wartość|W oknie 3M?|Kumulacja|
|:--|--:|:--|--:|
|XI 2023|4200|❌|-|
|XII 2023|5100|✅|5100|
|I 2024|6800|✅|11900|
|II 2024 (do 15)|4400|✅|**16300**|


---
### Przykład 3: Średnia krocząca 30 dni

```dax
Średnia 30D = 
CALCULATE(
    AVERAGE(fSprzedaz[Wartość]),
    DATESINPERIOD(
        Kalendarz[Data],
        MAX(Kalendarz[Data]),
        -30,
        DAY
    )
)
```

**Interpretacja:** Wygładza wahania dzienne, pokazując trend

---

# TOTALYTD

## Definicja

```dax
TOTALYTD(<expression>, <dates>, [<filter>], [<year_end_date>])
```

Oblicza **kumulację od początku roku** (Year to Date). Skrócona wersja `CALCULATE` + `DATESYTD`.


---
## Zastosowanie

### Przykład 1: Suma YTD

```dax
Sprzedaż YTD = 
TOTALYTD(
    SUM(fSprzedaz[Wartość]),
    Kalendarz[Data]
)
```

Identyczne działanie jak `CALCULATE(SUM(...), DATESYTD(...))` z poprzednich przykładów.


---
### Przykład 2: YTD z rokiem obrotowym

```dax
Sprzedaż YTD Fiskalny = 
TOTALYTD(
    SUM(fSprzedaz[Wartość]),
    Kalendarz[Data],
    ,
    "6/30"
)
```

**Rok obrotowy:** lipiec-czerwiec

|Data|YTD standardowy|YTD fiskalny (lip-cze)|
|:--|--:|--:|
|31.08.2024|45000|3200|
|31.12.2024|85000|42500|


---
### Przykład 3: Liczba transakcji YTD

```dax
Transakcje YTD = 
TOTALYTD(
    COUNTROWS(fSprzedaz),
    Kalendarz[Data]
)
```

**Kumulacja liczby wierszy:**

|Miesiąc|Transakcje miesięczne|Transakcje YTD|
|:--|--:|--:|
|Styczeń|45|45|
|Luty|52|97|
|Marzec|48|145|

---

# PARALLELPERIOD

## Definicja

```dax
PARALLELPERIOD(<dates>, <number_of_intervals>, <interval>)
```

Zwraca **równoległy okres** przesunięty o określoną liczbę interwałów. W przeciwieństwie do `DATEADD`, zwraca **pełny okres** (np. cały miesiąc), nie poszczególne daty.


---
## Zastosowanie

### Przykład 1: Pełny miesiąc rok temu

```dax
Sprzedaż Miesiąc RR = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    PARALLELPERIOD(Kalendarz[Data], -12, MONTH)
)
```

**Różnica vs DATEADD:**

|Funkcja|Luty 2024 →|Zwraca|
|:--|:--|:--|
|DATEADD|Luty 2023|Tylko dni z lutego 2023 które mają odpowiednik|
|PARALLELPERIOD|**Cały** luty 2023|Wszystkie dni lutego 2023 (1-28.02.2023)|


---
### Przykład 2: Poprzedni kwartał pełny

```dax
Sprzedaż Poprzedni Kwartał Pełny = 
CALCULATE(
    SUM(fSprzedaz[Wartość]),
    PARALLELPERIOD(Kalendarz[Data], -1, QUARTER)
)
```

**Porównanie kwartałów:**

|Bieżący Q|PARALLELPERIOD(-1, Q)|Wartość|
|:--|:--|--:|
|Q2 2024|**Cały** Q1 2024|24500|
|Q3 2024|**Cały** Q2 2024|27800|

---

# Tabela porównawcza funkcji

| Funkcja                | Typ operacji                | Zakres                   | Przykład użycia  |
| :--------------------- | :-------------------------- | :----------------------- | :--------------- |
| **SAMEPERIODLASTYEAR** | Przesunięcie                | -1 rok (dokładnie)       | YoY              |
| **DATESYTD**           | Kumulacja                   | 1 stycznia → dziś        | YTD              |
| **DATEADD**            | Przesunięcie                | Dowolny interwał         | MoM, wczoraj     |
| **TOTALMTD**           | Kumulacja                   | 1. dzień miesiąca → dziś | MTD              |
| **DATESINPERIOD**      | Okno przewijane             | Ostatnie N okresów       | Rolling 7D, 3M   |
| **TOTALYTD**           | Kumulacja                   | 1 stycznia → dziś        | YTD (skrócona)   |
| **PARALLELPERIOD**     | Przesunięcie pełnego okresu | Cały okres równoległy    | Pełny miesiąc RR |
|                        |                             |                          |                  |
