---
type: teoria
---

# Funkcje iteracyjne (X-functions)
## Po co funkcje iteracyjne?
W Power BI czÄ™sto potrzebujemy wykonaÄ‡ obliczenia, ktÃ³re wymagajÄ… poÅ‚Ä…czenia danych z rÃ³Å¼nych kolumn w tym samym wierszu. 
- **Na przykÅ‚ad:** chcemy obliczyÄ‡ wartoÅ›Ä‡ sprzedaÅ¼y mnoÅ¼Ä…c cenÄ™ przez iloÅ›Ä‡, albo marÅ¼Ä™ odejmujÄ…c koszt od przychodu.
- Standardowe funkcje jak `SUM` czy `AVERAGE` tego nie potrafiÄ… - one po prostu sumujÄ… gotowe wartoÅ›ci z jednej kolumny. 
- Dlatego DAX oferuje funkcje iteracyjne (X-functions), ktÃ³re potrafiÄ… 'przejÅ›Ä‡' przez kaÅ¼dy wiersz tabeli i wykonaÄ‡ dla niego wÅ‚asne obliczenie.

---
## Kluczowe wnioski
Funkcje iteracyjne przechodzÄ… przez **kaÅ¼dy wiersz tabeli** i wykonujÄ… obliczenia dla kaÅ¼dego wiersza osobno.

**Funkcje iteracyjne (`SUMX`, `AVERAGEX`):**
- ObliczajÄ… wyraÅ¼enie dla **kaÅ¼dego wiersza** osobno
- Dopiero potem wykonujÄ… agregacjÄ™ (sumÄ™, Å›redniÄ… itp.)

**ZwykÅ‚e funkcje agregujÄ…ce (`SUM`, `AVERAGE`):**
- Najpierw sumujÄ… kolumnÄ™
- Nie pozwalajÄ… na obliczenia wiersz po wierszu

ğŸ’¡ **Kiedy uÅ¼ywaÄ‡ X-funkcji?**
- Gdy musisz **pomnoÅ¼yÄ‡/podzieliÄ‡/dodaÄ‡** wartoÅ›ci z rÃ³Å¼nych kolumn w tym samym wierszu
- Gdy potrzebujesz **warunkowych obliczeÅ„** dla kaÅ¼dego wiersza
- Gdy standardowa `SUM`/`AVERAGE` nie wystarcza

---
# SUMX
## Jak dziaÅ‚a SUMX?
SUMX iteruje po wierszach, wiÄ™c poniÅ¼sza funkcja kolejno
- PrzemnoÅ¼y `iloÅ›Ä‡ ` i `CenÄ™` - wynikiem bÄ™dzie `WartoÅ›Ä‡ Netto`
- Zsumuje `WartoÅ›ci Netto`, zaleÅ¼nie od kontekstu

```dax
DAX
WartoÅ›Ä‡ ZamÃ³wieÅ„ = SUMX(Sprzedaz, Sprzedaz[Cena] * Sprzedaz[IloÅ›Ä‡])
```

### Proces iteracyjny krok po kroku:

| Iteracja | KATEGORIA | Cena | IloÅ›Ä‡ | Obliczenie (Cena Ã— IloÅ›Ä‡) | Wynik wiersza |
| -------- | --------- | ---- | ----- | ------------------------- | ------------- |
| 1        | NAPOJE    | 3000 | 2     | 3000 Ã— 2                  | 6000          |
| 2        | WINO      | 50   | 10    | 50 Ã— 10                   | 500           |
| 3        | KULINARKA | 150  | 5     | 150 Ã— 5                   | 750           |
| 4        | PRZEKÄ„SKI | 800  | 3     | 800 Ã— 3                   | 2400          |
| **SUMA** |           |      |       |                           | **9650**      |

**Wynik koÅ„cowy:** 9650 PLN

---

## PorÃ³wnanie: `SUMX` vs zwykÅ‚a `SUM`

### âŒ To NIE zadziaÅ‚a poprawnie:

```dax
DAX
BÅ‚Ä™dna WartoÅ›Ä‡ = SUM(Sprzedaz[Cena]) * SUM(Sprzedaz[IloÅ›Ä‡])
```

- SUM(Cena) = 3000 + 50 + 150 + 800 = **4000**
- SUM(IloÅ›Ä‡) = 2 + 10 + 5 + 3 = **20**
- Wynik: 4000 Ã— 20 = **80 000** âŒ (BÅ‚Ä™dny!)

### âœ… To dziaÅ‚a poprawnie:

```dax
DAX
Poprawna WartoÅ›Ä‡ = SUMX(Sprzedaz, Sprzedaz[Cena] * Sprzedaz[IloÅ›Ä‡])
```

- Wynik: **9650** âœ… (Poprawny!)

---

## WaÅ¼na uwaga:
**Nie uÅ¼ywaj X-funkcji tam, gdzie wystarczy zwykÅ‚a agregacja.** 
JeÅ›li po prostu chcesz zsumowaÄ‡ wartoÅ›ci z jednej kolumny, uÅ¼yj `SUM` - bÄ™dzie znacznie szybsza. `X`-funkcje uruchamiaj siÄ™ tylko wtedy, gdy musisz coÅ› obliczyÄ‡ **w locie** dla kaÅ¼dego wiersza. KaÅ¼da niepotrzebna iteracja spowalnia raport.

---
# AVERAGEX
## `AVERAGEX` â€“ Åšrednia z iteracjÄ…

`AVERAGEX` jest szczegÃ³lnie przydatna, gdy potrzebujesz Å›redniej z obliczeÅ„, a nie z gotowej kolumny. ZwrÃ³Ä‡ uwagÄ™ na kluczowÄ… rÃ³Å¼nicÄ™: AVERAGE(Sprzedaz[MarÅ¼a]) obliczyÅ‚aby Å›redniÄ… z kolumny MarÅ¼a (gdyby taka istniaÅ‚a), ale AVERAGEX pozwala obliczyÄ‡ marÅ¼Ä™ dla kaÅ¼dego wiersza osobno, a dopiero potem uÅ›redniÄ‡ wyniki.

```dax
DAX
AVERAGEX(<tabela>, <wyraÅ¼enie>)
```


**PrzykÅ‚ad:**

```dax
DAX
Åšrednia MarÅ¼a = 
AVERAGEX(
    Sprzedaz,
    Sprzedaz[WartoÅ›Ä‡ Netto] - Sprzedaz[Koszty Netto]
)
```

---
# COUNTX
## `COUNTX` â€“ Liczenie z iteracjÄ…

`COUNTX` rÃ³Å¼ni siÄ™ od `COUNT` tym, Å¼e moÅ¼esz w niej zdefiniowaÄ‡ warunek dla kaÅ¼dego wiersza. W przykÅ‚adzie powyÅ¼ej funkcja `IF` zwraca 1 lub `BLANK()` - `COUNTX` policzy tylko te wiersze, gdzie dostaÅ‚a wartoÅ›Ä‡ (nie `BLANK`). To pozwala na warunkowe liczenie bez uÅ¼ywania `CALCULATE`.

```dax
DAX
COUNTX(<tabela>, <wyraÅ¼enie>)
```


**PrzykÅ‚ad:**
Liczy ile razy wyraÅ¼enie zwrÃ³ciÅ‚o **niepustÄ… wartoÅ›Ä‡**.
```dax
DAX
Liczba ZamÃ³wieÅ„ PowyÅ¼ej 1000 = 
COUNTX(
    Sprzedaz,
    IF(Sprzedaz[WartoÅ›Ä‡ Netto] > 1000, 1, BLANK())
)
```

---
# MINX i MAXX
## `MINX` i `MAXX` â€“ Minimum i maksimum z iteracjÄ…

MINX i MAXX sÄ… czÄ™sto niedoceniane, ale potrafiÄ… rozwiÄ…zaÄ‡ problemy, z ktÃ³rymi zwykÅ‚e MIN i MAX sobie nie poradzÄ…. Kluczowa rÃ³Å¼nica: MIN i MAX mogÄ… znaleÅºÄ‡ tylko najmniejszÄ… lub najwiÄ™kszÄ… wartoÅ›Ä‡ z gotowej kolumny. MINX i MAXX potrafiÄ… znaleÅºÄ‡ ekstremalnÄ… wartoÅ›Ä‡ z obliczeÅ„ wykonanych dla kaÅ¼dego wiersza.

```dax
DAX
MINX(<tabela>, <wyraÅ¼enie>)
MAXX(<tabela>, <wyraÅ¼enie>)
```

**PrzykÅ‚ad:**

```dax
DAX
NajwyÅ¼sza MarÅ¼a = 
MAXX(
    Sprzedaz,
    Sprzedaz[WartoÅ›Ä‡ Netto] - Sprzedaz[Koszty Netto]
)
```

