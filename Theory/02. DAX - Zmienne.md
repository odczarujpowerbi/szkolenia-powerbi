## Czym są VAR i RETURN?

**VAR** i **RETURN** to kluczowe słowa w języku DAX, które pozwalają na tworzenie **zmiennych** i **zwracanie wyników** w miarach i kolumnach kalkulowanych.

### VAR (Variable)
- Służy do **deklarowania zmiennych** i przechowywania w nich wartości
- Zmienne mogą zawierać: liczby, teksty, tabele, wyniki obliczeń
- Zmienne są **obliczane tylko raz** i przechowują swoją wartość
- Pomagają **unikać powtarzania** tego samego kodu
- Poprawiają **czytelność** i **wydajność** miar

### RETURN
- **Zwraca wynik** całego wyrażenia DAX
- W mierze/kolumnie może być **tylko jedno RETURN**
- To, co umieścisz po RETURN, stanie się **końcowym wynikiem**

---

## Podstawowa składnia

```dax
NazwaMiary = 
VAR NazwaZmiennej1 = <wyrażenie1>
VAR NazwaZmiennej2 = <wyrażenie2>
VAR NazwaZmiennej3 = <wyrażenie3>
RETURN <wynik_końcowy>
```

**Przykład prosty:**

```dax
Całkowity Koszt = 
VAR IloscSztuk = 100
VAR CenaJednostkowa = 25
VAR Koszt = IloscSztuk * CenaJednostkowa
RETURN Koszt
```

Wynik: **2500**

---

## Jak to działa w funkcjach iteracyjnych (SUMX, FILTER, itd.)?

W funkcjach iteracyjnych jak **SUMX**, **FILTER**, **ADDCOLUMNS** zmienne VAR są **przetwarzane w każdej iteracji**:

**Zasada:** Dla każdego wiersza tabeli, zmienne VAR są **obliczane na nowo** z wartościami z aktualnego wiersza.


```dax
SUMX(
    {1, 2, 3},  -- Iterujemy po wartościach 1, 2, 3
    VAR Kwadrat = [Value] * [Value] -- [Value] to domyślna nazwa utworzonej kolumny
    RETURN Kwadrat
)
```

## Kroki algorytmu:

### Iteracja 1: [Value] = 1

- `Kwadrat` = 1 × 1 = **1**
- RETURN zwraca: **1**

### Iteracja 2: [Value] = 2

- `Kwadrat` = 2 × 2 = **4**
- RETURN zwraca: **4**

### Iteracja 3: [Value] = 3

- `Kwadrat` = 3 × 3 = **9**
- RETURN zwraca: **9**


SUMX dodaje wszystkie zwrócone wartości: 1 + 4 + 9 = **14**

W każdej iteracji zmienna `Kwadrat` jest **tworzona od nowa** z nową wartością! Nie jest to ta sama zmienna — każda iteracja ma własny "kontekst wiersza" i własne wartości zmiennych.

**To oznacza:**
- Zmienne VAR wewnątrz iteracji są **dynamiczne**
- Dostosowują się do **aktualnego wiersza** w tabeli
- Pozwalają na **elastyczne obliczenia** dla każdego elementu z osobna

---
## Odchylenie od średniej

```dax
Suma Odchyleń od Średniej = 
VAR Srednia = AVERAGE({1, 2, 3, 4, 5})  -- Obliczona raz: 3
RETURN
    SUMX(
        {1, 2, 3},
        VAR Wartosc = [Value]
        VAR Odchylenie = Wartosc - Srednia  -- Używamy zmiennej spoza iteracji!
        RETURN Odchylenie
    )
```

## Co się dzieje krok po kroku:

### Przed iteracją:

- `Srednia` = (1 + 2 + 3) / 3 = 2 ← obliczone **tylko raz**

### Iteracja 1: [Value] = 1

- `Wartosc` = 1
- `Odchylenie` = 1 - 3 = **-2**
- RETURN zwraca: **-2**

### Iteracja 2: [Value] = 2

- `Wartosc` = 2
- `Odchylenie` = 2 - 3 = **-1**
- RETURN zwraca: **-1**

### Iteracja 3: [Value] = 3

- `Wartosc` = 3
- `Odchylenie` = 3 - 3 = **0**
- RETURN zwraca: **0**


### Suma końcowa:
SUMX dodaje wszystkie odchylenia: (-2) + (-1) + 0 = **-3**